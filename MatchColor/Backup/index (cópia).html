<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Match Colors</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Varela+Round&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Varela Round', sans-serif;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            margin: 0;
            background-color: #f7e1e1; /* Fundo mais suave */
            color: #4a2f4d; /* Cor do texto mais "doce" */
            padding: 10px;
            box-sizing: border-box;
            transition: background-color 0.2s;
        }

        body.flash-red {
            background-color: #ff8c94; /* Tom de vermelho mais doce */
        }

        h1 {
            margin-bottom: 10px;
            font-size: 2.5em;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.1); /* Sombra para destacar o título */
        }

        .level-select-wrapper {
            margin-bottom: 15px;
        }

        #level-select {
            padding: 8px 12px;
            font-size: 1em;
            border-radius: 10px; /* Bordas mais arredondadas */
            border: 2px solid #a37b8a; /* Borda mais estilizada */
            -webkit-appearance: none;
            -moz-appearance: none;
            appearance: none;
            background-color: white;
            cursor: pointer;
            box-shadow: 0 4px 8px rgba(0,0,0,0.15);
            color: #4a2f4d;
        }

        .info-bar {
            display: flex;
            justify-content: space-around;
            align-items: center;
            width: 100%;
            max-width: 500px;
            margin-bottom: 15px;
            background-color: #ffe8d6; /* Fundo mais suave */
            padding: 12px 0; /* Mais padding */
            border-radius: 15px; /* Bordas mais arredondadas */
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
            flex-wrap: wrap;
        }

        .info-item {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 1.5em;
            font-weight: 600;
            white-space: nowrap;
        }

        #color-to-match {
            width: 30px;
            height: 30px;
            border-radius: 50%; /* Agora é um círculo */
            border: 3px solid #4a2f4d;
            box-sizing: border-box;
            box-shadow: inset 0 0 5px rgba(0,0,0,0.2); /* Sombra interna para profundidade */
        }

        #game-container {
            position: relative;
            display: grid;
            gap: 12px;
            box-shadow: 0 6px 15px rgba(0, 0, 0, 0.2);
            border-radius: 20px; /* Bordas super arredondadas */
            padding: 20px;
            background-color: #ffe8d6;
            transform: scale(1);
            transition: transform 0.2s ease;
            max-width: 90vw;
            width: 500px;
        }

        @media (max-width: 540px) {
            h1 {
                font-size: 2em;
            }
            .info-item {
                font-size: 1.2em;
                margin: 5px 0;
            }
            .info-bar {
                flex-direction: row;
                justify-content: space-evenly;
                gap: 5px;
            }
            #game-container {
                width: 90vw;
                padding: 10px;
                gap: 8px;
            }
        }
        
        @media (max-width: 380px) {
            .info-bar {
                flex-direction: column;
            }
        }

        .square {
            border-radius: 20px; /* Bordas super arredondadas */
            cursor: pointer;
            transition: transform 0.1s ease, box-shadow 0.1s ease;
            aspect-ratio: 1 / 1;
            box-shadow: 0 5px 10px rgba(0,0,0,0.2);
            /* Gradiente para efeito glossy, adicionado via JS para cores dinâmicas */
        }

        .square:active {
            transform: translateY(2px);
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
        }

        #game-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            background-color: rgba(255, 255, 255, 0.85);
            border-radius: 20px;
            text-align: center;
            padding: 20px;
            box-sizing: border-box;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s ease;
        }

        #game-overlay.visible {
            opacity: 1;
            pointer-events: auto;
        }

        #final-score {
            font-size: 2.2em;
            font-weight: bold;
            color: #4a2f4d;
            margin-bottom: 10px;
        }
        
        #game-over-message {
            font-size: 1.4em;
            font-style: italic;
            color: #8c738e;
            margin-bottom: 20px;
        }

        #restart-button {
            padding: 15px 30px;
            font-size: 1.2em;
            font-weight: 600;
            cursor: pointer;
            background-color: #ff717c; /* Botão com cor de bala */
            color: white;
            border: none;
            border-radius: 15px;
            box-shadow: 0 5px 10px rgba(0, 0, 0, 0.2);
            transition: background-color 0.3s ease, transform 0.1s ease;
        }

        #restart-button:hover {
            background-color: #ff4d5a;
        }

        /* Classes de utilidade */
        .hidden {
            display: none !important;
        }
    </style>
</head>
<body>

    <h1>Match Colors</h1>

    <div class="level-select-wrapper" id="level-select-wrapper">
        Nível:
        <select id="level-select">
            <option value="easy">Fácil (2x2)</option>
            <option value="normal" selected>Normal (3x3)</option>
            <option value="hard">Difícil (4x4)</option>
            <option value="insane">Insano (5x5)</option>
            <option value="zen">Zen (Sem Tempo)</option>
        </select>
    </div>

    <div class="info-bar" id="info-bar">
        <div class="info-item" id="timer-display">
            Tempo: <span id="timer">30</span>s
        </div>
        <div class="info-item">
            Vidas: <span id="lives">3</span>
        </div>
        <div class="info-item">
            Cor a achar: <div id="color-to-match"></div>
        </div>
        <div class="info-item">
            Pontos: <span id="score">0</span>
        </div>
    </div>
    
    <div id="game-container">
        <div id="game-overlay">
            <div id="final-score"></div>
            <div id="game-over-message"></div>
            <button id="restart-button">Iniciar Jogo</button>
        </div>
    </div>

    <script>
        const gameContainer = document.getElementById('game-container');
        const scoreElement = document.getElementById('score');
        const timerElement = document.getElementById('timer');
        const livesElement = document.getElementById('lives');
        const finalScoreElement = document.getElementById('final-score');
        const gameOverMessageElement = document.getElementById('game-over-message');
        const restartButton = document.getElementById('restart-button');
        const levelSelect = document.getElementById('level-select');
        const levelSelectWrapper = document.getElementById('level-select-wrapper');
        const timerDisplay = document.getElementById('timer-display');
        const colorToMatchElement = document.getElementById('color-to-match');
        const infoBar = document.getElementById('info-bar');
        const gameOverlay = document.getElementById('game-overlay');
        
        const zenLevels = ['easy', 'normal', 'hard', 'insane'];
        const levelMap = {
            easy: 2,
            normal: 3,
            hard: 4,
            insane: 5
        };
        
        let score = 0;
        let timeLeft = 30;
        let lives = 3;
        let timerInterval;
        let gameActive = false;
        let gridSize;
        let differentSquaresCount = 1;
        let zenLevelIndex = 0;
        let correctClicksThisRound = 0;
        let baseColor = '';

        function getRandomHexColor() {
            return '#' + Math.floor(Math.random() * 16777215).toString(16).padStart(6, '0');
        }

        function getComplementaryColor(hex) {
            const r = parseInt(hex.substring(1, 3), 16);
            const g = parseInt(hex.substring(3, 5), 16);
            const b = parseInt(hex.substring(5, 7), 16);
            
            const rComp = 255 - r;
            const gComp = 255 - g;
            const bComp = 255 - b;

            return `#${rComp.toString(16).padStart(2, '0')}${gComp.toString(16).padStart(2, '0')}${bComp.toString(16).padStart(2, '0')}`;
        }

        function flashRed() {
            document.body.classList.add('flash-red');
            setTimeout(() => {
                document.body.classList.remove('flash-red');
            }, 300);
        }
        
        function handleCorrectClick(square) {
            score++;
            scoreElement.textContent = score;
            correctClicksThisRound++;

            square.style.background = baseColor;
            square.dataset.isDifferent = 'false';
            square.style.cursor = 'default';

            if (correctClicksThisRound === differentSquaresCount) {
                if (levelSelect.value === 'zen') {
                    handleZenProgression(gridSize * gridSize);
                } else {
                    handleTimedProgression();
                }
            }
        }

        function handleIncorrectClick() {
            if (lives > 0) {
                lives--;
                livesElement.textContent = lives;
                flashRed();
                if ('vibrate' in navigator) {
                    navigator.vibrate(200); 
                }
                if (lives === 0) {
                    endGame('Suas vidas acabaram!');
                }
            }
        }
        
        function updateBoard() {
            if (!gameActive) return;

            gameContainer.innerHTML = ''; // Limpa apenas os quadrados, não o overlay
            const totalSquares = gridSize * gridSize;
            baseColor = getRandomHexColor();
            const differentColor = getComplementaryColor(baseColor);
            
            colorToMatchElement.style.background = `radial-gradient(circle at 25% 25%, white, ${differentColor})`;
            
            correctClicksThisRound = 0;
            
            const differentIndexes = new Set();
            while (differentIndexes.size < differentSquaresCount) {
                differentIndexes.add(Math.floor(Math.random() * totalSquares));
            }

            for (let i = 0; i < totalSquares; i++) {
                const square = document.createElement('div');
                square.classList.add('square');
                square.dataset.isDifferent = differentIndexes.has(i);
                
                if (square.dataset.isDifferent === 'true') {
                    square.style.background = `radial-gradient(circle at 25% 25%, white, ${differentColor})`;
                } else {
                    square.style.background = `radial-gradient(circle at 25% 25%, white, ${baseColor})`;
                }
                
                square.addEventListener('click', () => {
                    if (!gameActive) return;
                    if (square.dataset.isDifferent === 'true') {
                        handleCorrectClick(square);
                    } else {
                        handleIncorrectClick();
                    }
                });
                gameContainer.appendChild(square);
            }

            gameContainer.appendChild(gameOverlay);
        }

        function handleZenProgression(totalSquares) {
            zenClicksCounter++;

            if (zenClicksCounter % 10 === 0 && differentSquaresCount < totalSquares - 1) {
                differentSquaresCount++;
            }

            if (differentSquaresCount === totalSquares - 1) {
                if (zenLevelIndex < zenLevels.length - 1) {
                    zenLevelIndex++;
                    gridSize = levelMap[zenLevels[zenLevelIndex]];
                    differentSquaresCount = 1;
                    gameContainer.style.gridTemplateColumns = `repeat(${gridSize}, 1fr)`;
                    gameContainer.style.gridTemplateRows = `repeat(${gridSize}, 1fr)`;
                } else {
                    endZenMode();
                    return;
                }
            }
            setTimeout(updateBoard, 500);
        }

        function handleTimedProgression() {
            differentSquaresCount++;
            if (differentSquaresCount === (gridSize * gridSize)) {
                differentSquaresCount = 1;
            }
            setTimeout(updateBoard, 500);
        }

        function handleTimer() {
            if (!gameActive) return;
            timeLeft--;
            timerElement.textContent = timeLeft;
            if (timeLeft <= 0) {
                endGame('Tempo esgotado!');
            }
        }

        function endGame(message) {
            gameActive = false;
            clearInterval(timerInterval);
            finalScoreElement.textContent = `Pontuação final: ${score}`;
            gameOverMessageElement.textContent = message;
            restartButton.textContent = 'Jogar Novamente';
            gameOverlay.classList.add('visible');
            levelSelectWrapper.classList.remove('hidden');
        }

        function endZenMode() {
            gameActive = false;
            finalScoreElement.textContent = `Pontuação final: ${score}`;
            gameOverMessageElement.textContent = 'Parabéns, você deve ter relaxado bastante...';
            restartButton.textContent = 'Jogar Novamente';
            gameOverlay.classList.add('visible');
            levelSelectWrapper.classList.remove('hidden');
        }

        function startGame() {
            gameActive = true;
            score = 0;
            timeLeft = 30;
            lives = 3;
            differentSquaresCount = 1;
            zenClicksCounter = 0;
            zenLevelIndex = 0;
            
            if (levelSelect.value === 'zen') {
                gridSize = levelMap[zenLevels[zenLevelIndex]];
                timerDisplay.classList.add('hidden');
                clearInterval(timerInterval);
            } else {
                gridSize = levelMap[levelSelect.value];
                timerDisplay.classList.remove('hidden');
                clearInterval(timerInterval);
                timerInterval = setInterval(handleTimer, 1000);
            }
            
            gameContainer.style.gridTemplateColumns = `repeat(${gridSize}, 1fr)`;
            gameContainer.style.gridTemplateRows = `repeat(${gridSize}, 1fr)`;

            scoreElement.textContent = score;
            livesElement.textContent = lives;
            timerElement.textContent = timeLeft;
            gameOverlay.classList.remove('visible');
            levelSelectWrapper.classList.add('hidden');
            
            updateBoard();
        }

        window.addEventListener('load', () => {
            gameOverlay.classList.add('visible');
            levelSelectWrapper.classList.remove('hidden');
            restartButton.textContent = 'Iniciar Jogo';
        });

        restartButton.addEventListener('click', startGame);
        levelSelect.addEventListener('change', () => {
            if (!gameActive) {
                gridSize = levelMap[levelSelect.value === 'zen' ? zenLevels[zenLevelIndex] : levelSelect.value];
                gameContainer.style.gridTemplateColumns = `repeat(${gridSize}, 1fr)`;
                gameContainer.style.gridTemplateRows = `repeat(${gridSize}, 1fr)`;
                
                if (levelSelect.value === 'zen') {
                    timerDisplay.classList.add('hidden');
                } else {
                    timerDisplay.classList.remove('hidden');
                }

                gameContainer.innerHTML = '';
                const totalSquares = gridSize * gridSize;
                baseColor = getRandomHexColor();
                const tempDifferentColor = getComplementaryColor(baseColor);
                colorToMatchElement.style.background = `radial-gradient(circle at 25% 25%, white, ${tempDifferentColor})`;

                const differentIndexes = new Set();
                while (differentIndexes.size < differentSquaresCount) {
                    differentIndexes.add(Math.floor(Math.random() * totalSquares));
                }

                for (let i = 0; i < totalSquares; i++) {
                    const square = document.createElement('div');
                    square.classList.add('square');
                    if (differentIndexes.has(i)) {
                        square.style.background = `radial-gradient(circle at 25% 25%, white, ${tempDifferentColor})`;
                    } else {
                        square.style.background = `radial-gradient(circle at 25% 25%, white, ${baseColor})`;
                    }
                    gameContainer.appendChild(square);
                }
                gameContainer.appendChild(gameOverlay);
            } else {
                startGame();
            }
        });
        
        document.addEventListener('keydown', function(event) {
            if (event.ctrlKey === true || event.metaKey === true) {
                if (event.key === '-' || event.key === '=' || event.key === '0') {
                    event.preventDefault();
                }
            }
        });

        document.addEventListener('wheel', function(event) {
            if (event.ctrlKey === true || event.metaKey === true) {
                event.preventDefault();
            }
        }, { passive: false });
    </script>
</body>
</html>
